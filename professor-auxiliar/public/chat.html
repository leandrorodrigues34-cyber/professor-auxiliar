<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Professor Auxiliar</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;background:#0b0b10;color:#f5f5f7}
    .wrap{max-width:820px;margin:0 auto;padding:24px}
    .card{background:#14141c;border:1px solid #2a2a38;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);overflow:hidden}
    .head{padding:16px 20px;border-bottom:1px solid #222}
    .msgs{height:58vh;overflow:auto;padding:16px 20px;line-height:1.5}
    .bubble{padding:10px 14px;border-radius:10px;margin:8px 0;max-width:80%}
    .user{background:#1f2333}
    .bot{background:#151a28;border:1px solid #27324a}
    .row{display:flex;gap:8px;padding:12px;border-top:1px solid #222;background:#0f1017}
    input,button{font-size:16px}
    input{flex:1;padding:12px 14px;border-radius:10px;border:1px solid #2a2a38;background:#14141c;color:#fff}
    button{padding:12px 16px;border-radius:10px;border:1px solid #334;background:#1d2a5a;color:#fff;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head"><b>Professor Auxiliar</b> · planos de estudo e dúvidas</div>
      <div id="msgs" class="msgs"></div>
      <div class="row">
        <input id="inp" placeholder="Escreva sua dúvida ou objetivo (ex.: sou iniciante e quero acordes maiores)"/>
        <button id="btn">Enviar</button>
      </div>
    </div>
  </div>
<script>
let threadId = null;
const msgsEl = document.getElementById('msgs');
const inp = document.getElementById('inp');
const btn = document.getElementById('btn');

function add(who, text){
  const d = document.createElement('div');
  d.className = 'bubble ' + (who === 'user' ? 'user' : 'bot');
  d.textContent = text;
  msgsEl.appendChild(d);
  msgsEl.scrollTop = msgsEl.scrollHeight;
}

async function start(){
  const r = await fetch('/api/start', { method:'POST' });
  const j = await r.json();
  threadId = j.thread_id;
  if (j.welcome) add('bot', j.welcome);
}
async function send(){
  const text = inp.value.trim();
  if (!text || !threadId) return;
  btn.disabled = true;
  add('user', text);
  inp.value = '';
  const r = await fetch('/api/send', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ thread_id: threadId, text })
  });
  const j = await r.json();
  add('bot', j.reply || '…');
  btn.disabled = false;
}

btn.onclick = send;
inp.addEventListener('keydown', e => { if (e.key === 'Enter') send(); });

start(); // inicia e mostra a mensagem de boas-vindas
</script>
</body>
</html>
